---
import { getCollection } from "astro:content";
import BlogOverview from "../../../components/BlogOverview";
import Footer from "../../../components/Footer";
import Header from "../../../components/Header";
import Layout from "../../../layouts/Layout.astro";

export async function getStaticPaths() {
  const categories = await getCollection("categories");
  return categories.map((category) => ({
    params: { category: category.data.slug },
    props: { category },
  }));
}

const posts = await getCollection("posts");
const category = Astro.params.category;
posts.sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime());
const filteredPosts = posts.filter((post) => post.data.category.slug === category);

const headerMenuItems = await getCollection("headerMenuItems");
headerMenuItems.sort((a, b) => a.data.order - b.data.order)

const footerSocialMediaIcons = await getCollection('footerSocialMediaIcons');
footerSocialMediaIcons.sort((a, b) => a.data.order - b.data.order)

const footerMenuItems = await getCollection('footerMenuItems');
footerMenuItems.sort((a, b) => a.data.order - b.data.order)
---
<Layout
  title="Blog - 2martens.de"
  description="2martens.de - The official website of Jim Martens"
  appName="2martens.de"
>
  <Header appName="2martens.de" menuItems={headerMenuItems} client:load />
  <BlogOverview posts={filteredPosts} basehref="/posts" />
  <Footer footerMenuItems={footerMenuItems} socialMediaIcons={footerSocialMediaIcons} />
</Layout>